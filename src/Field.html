<script context="module">
  /*** field states ***/
  export const fState = { alive: true, dead: false }
  //
  export const createField = (pos, dimension) => {
    let _state = fState.dead,
      _prevState = _state
    //
    const row = ~~(pos / dimension),
      col = pos % dimension || 0,
      //
      hasChanged = () => _state ^ _prevState,
      hasState = state => _state === state,
      hasChangedState = state => hasState(state) && hasChanged(),
      nextState = count => (count === 4 ? _state : count === 3),
      //
      _set = (state = fState.dead, prevState = state) =>
        void ((_state = state), (_prevState = prevState)),
      _changeTo = state => _set(state, _state)
    //
    // Component Interface
    return {
      //
      // static getters
      stat: { row, col, state: () => _state },
      // dynamic getters ----------------
      hasState,
      hasChanged,
      hasChangedState,
      nextState,
      // setters ------------------------
      setState: state => _changeTo(state),
      setEmpty: () => _set(),
      setRandom: () => _changeTo(Math.random() * 6 > 4),
      flip: () => _changeTo(!_state)
    }
  }
</script>
