<td class="{_colorState}" style="height: {cellWidth}px;" on:click="{flip}"></td>

<style>
  td {
    padding: 0;
  }
</style>

<script>
  import { createEventDispatcher } from "svelte"

  /***  Default Component Interface ***/
  export let row, col, state, cellWidth

  /*** Observables ***/
  // background color based on state
  $: _colorState = state ? "is-info" : ""

  /*** Events ***/
  const dispatch = createEventDispatcher(),
    flip = () => dispatch("flip", { row, col })
</script>

<script context="module">
  /*** field states ***/
  export const fState = { alive: 1, dead: 0 }
  //
  export const createField = (pos = 0, dimension = 1) => {
    let _state = fState.dead,
      _prevState = _state
    //
    const row = Math.floor(pos / dimension),
      col = pos % dimension,
      //
      hasChanged = () => _state ^ _prevState,
      hasState = state => _state === state,
      hasChangedState = state => hasState(state) && hasChanged(),
      nextState = count => +(count === 3 || count - _state === 3),
      //
      _set = (state = fState.dead, prevState = state) =>
        void ((_state = state), (_prevState = prevState)),
      _changeTo = state => _set(state, _state)
    //
    // Component Interface
    return {
      //
      // static getters
      row,
      col,
      //
      // dynamic getters
      state: () => _state,
      hasState,
      hasChanged,
      hasChangedState,
      nextState,
      //
      // setters
      setState: state => _changeTo(state),
      setEmpty: () => _set(),
      setRandom: () => _set(+(Math.round(Math.random() * 6) > 3)),
      flip: () => _changeTo(+!_state)
    }
  }
</script>
