<g
  ><rect
    height="{cellWidth}"
    width="{cellWidth}"
    class="{_colorState}"
    {x}
    {y}
    on:click="{flip}"
  ></rect
></g>

<style>
  .alive {
    fill: #00d1b2;
  }
  .dead {
    fill: #ddd;
  }
</style>

<script>
  import { createEventDispatcher } from "svelte"

  /***  Default Component Interface ***/
  export let pos, row, col, state, cellWidth

  /*** Observables ***/
  // background color based on state
  $: _colorState = state ? "alive" : "dead"
  $: x = cellWidth * col + 1
  $: y = cellWidth * row + 1

  /*** Events ***/
  const dispatch = createEventDispatcher(),
    flip = () => dispatch("flip", pos)
</script>

<script context="module">
  /*** field states ***/
  export const fState = { alive: 1, dead: 0 }
  //
  export const createField = (pos = 0, dimension = 1) => {
    let _state = fState.dead,
      _prevState = _state
    //
    const row = Math.floor(pos / dimension),
      col = pos % dimension,
      //
      hasChanged = () => _state ^ _prevState,
      hasState = state => _state === state,
      hasChangedState = state => hasState(state) && hasChanged(),
      nextState = count => +(count === 4 ? _state : count === 3),
      //
      _set = (state = fState.dead, prevState = state) =>
        void ((_state = state), (_prevState = prevState)),
      _changeTo = state => _set(state, _state)
    //
    // Component Interface
    return {
      //
      // static getters
      pos,
      row,
      col,
      // dynamic getters
      state: () => _state,
      hasState,
      hasChanged,
      hasChangedState,
      nextState,
      //
      // setters
      setState: state => _changeTo(state),
      setEmpty: () => _set(),
      setRandom: () => _changeTo(+(Math.round(Math.random() * 6) > 3)),
      flip: () => _changeTo(+!_state)
    }
  }
</script>
