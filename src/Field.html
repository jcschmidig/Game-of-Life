<td
  class="{_colorState}"
  style="height: {cellWidth}px;"
  on:click="{flip}"
></td>

<style>
    td { padding: 0; }
</style>

<script>
  import { createEventDispatcher } from "svelte"

  /***  Default Component Interface ***/
  export let row, col, state, cellWidth

  /*** Observables ***/
  // background color based on state
  $: _colorState = state ? "is-info" : ""

  /*** Events ***/
  const dispatch = createEventDispatcher(),
    flip = () => dispatch("flip", {row, col})
</script>

<script context="module">
  /*** field states ***/
  export const fState = { alive: 1, dead: 0 }
  //
  export const createField = (_pos = 0, _dimension = 1) => {
    const row = Math.floor(_pos / _dimension),
      col = _pos % _dimension
    let _state = fState.dead,
      _prevState = _state
    //
    const hasChanged = () => _state ^ _prevState,
      hasState = state => _state === state,
      //
      _set = (state = fState.dead, prevState = state) =>
        void ((_state = state), (_prevState = prevState)),
      _changeTo = state => _set(state, _state)
    //
    // Component Interface
    return {
      //
      // static getters
      row,
      col,
      //
      // dynamic getters
      state: () => _state,
      hasState,
      hasChanged,
      hasChangedState: state => hasState(state) && hasChanged(),
      //
      // setters
      setState: state => _changeTo(state),
      setEmpty: () => _set(),
      setRandom: () => _set(+(Math.round(Math.random()*6)>3)),
      flip: () => _changeTo(+!_state)
    }
  }
</script>
