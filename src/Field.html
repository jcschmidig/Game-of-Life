<button class="{_colorState} {_colorCycle}" on:click={flip}/>

<style>
    button {
        width: 30px; height: 30px; border-width: 2px;
        cursor: crosshair; margin: 2px; padding: 1px; }
    .dead { background-color: lightgrey; }
    .alive { background-color: aqua; }
    .unchanged { border-color: white; }
    .changed-dead { border-color: black; }
    .changed-alive { border-color: blue; }
</style>

<script>
    import { createEventDispatcher } from 'svelte'

    /***  Default Component Interface ***/
    export let index, state, changed

    /*** Observables ***/
    // background color based on state
    $: _colorState = state ? "alive" : "dead"
    // border color based on change
    $: _colorCycle = changed ? "changed-"+_colorState : "unchanged"

    /*** Events ***/
    const
        dispatch = createEventDispatcher(),
        flip = () => dispatch( "flip", index )
</script>

<script context="module">
    /*** field states ***/
    export const fState = { alive: 1, dead: 0 }
    //
    export const createField = (_pos=0) => {
        const index = _pos
        let _state = fState.dead, _prevState = null
        //
        const
            hasChanged = () => _state^_prevState,
            hasState = state => _state === state,
            //
            _set = (state=fState.dead, prevState=state) =>
                void( _state = state, _prevState = prevState ),
            _changeTo = state => _set(state, _state)
        //
        // Component Interface
        return {
            //
            // static getters
            index,
            //
            // dynamic getters
            state: () => _state,
            hasState,
            hasChanged,
            hasChangedState: (state) => hasState(state) && hasChanged(),
            //
            // setters
            setState: state => _changeTo(state),
            setEmpty: () => _set(),
            setRandom: () => _set(Math.round(Math.random())),
            flip: () => _changeTo(+!_state)
        }
    }
</script>
