<td
  class="{_colorState}"
  style="padding: {cellWidth}px; "
  on:click="{flip}"
></td>

<script>
  import { createEventDispatcher } from "svelte"

  /***  Default Component Interface ***/
  export let index, state, changed, cellWidth

  /*** Observables ***/
  // background color based on state
  $: _colorState = state ? "is-success" : ""

  /*** Events ***/
  const dispatch = createEventDispatcher(),
    flip = () => dispatch("flip", index)
</script>

<script context="module">
  /*** field states ***/
  export const fState = { alive: 1, dead: 0 }
  //
  export const createField = (_pos = 0) => {
    const index = _pos
    let _state = fState.dead,
      _prevState = _state
    //
    const hasChanged = () => _state ^ _prevState,
      hasState = state => _state === state,
      //
      _set = (state = fState.dead, prevState = state) =>
        void ((_state = state), (_prevState = prevState)),
      _changeTo = state => _set(state, _state)
    //
    // Component Interface
    return {
      //
      // static getters
      index,
      //
      // dynamic getters
      state: () => _state,
      hasState,
      hasChanged,
      hasChangedState: state => hasState(state) && hasChanged(),
      //
      // setters
      setState: state => _changeTo(state),
      setEmpty: () => _set(),
      setRandom: () => _set(Math.round(Math.random())),
      flip: () => _changeTo(+!_state)
    }
  }
</script>
