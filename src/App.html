<!--
	Web App to simulate
	---------------------
	Conway's Game of Life
	(see https://en.wikipedia.org/wiki/Conway%27s_Game_of_Life)
	---------------------
	by jean-claude@schmidig.email
-->
<section class="section container">
  <h1 class="title is-3 is-size-2-tablet is-size-1-desktop has-text-centered">
    <a
      href="https://en.wikipedia.org/wiki/Conway%27s_Game_of_Life"
      target="_blank"
      >Conways's Game of Life</a
    >
  </h1>
</section>
<Start
  {markOffset}
  {defDimension}
  {dimMin}
  {dimMax}
  on:clear="{clear}"
  on:create="{create}"
/>
<Game
  {status}
  calcTitle="{calc.title}"
  {calcDiff}
  showTitle="{show.title}"
  {showDiff}
  on:click="{next}"
/>
<Board
  {fields}
  {screenWidth}
  {cellWidth}
  on:flip="{flip}"
  on:startMeasure="{startMeasure}"
  on:endMeasure="{endMeasure}"
/>

<script>
  import Start from "./Start.html"
  import Game from "./Game.html"
  import Board, { createBoard } from "./Board.html"
  import { createMeasure } from "./common/Measure.html"
  //
  let board, fields, cellWidth, screenWidth, showDiff, calcDiff, status
  const [defDimension, dimMin, dimMax] = [15, 3, 1000],
    markOffset = "idOffset",
    calc = createMeasure("Calc"),
    show = createMeasure("Display"),
    mCalc = (action, ...arg) => (calcDiff = calc.measure(action, ...arg))

  /*** Observables ***/
  $: if (board) {
    fields = board.fields()
    cellWidth = ~~(
      document.getElementById(markOffset).offsetWidth / board.length
    )
    screenWidth = cellWidth * board.length
    status = board.stat
  }

  /*** events ***/
  const evt = (action, newBoard = false) => (event, prop = event.detail) =>
      mCalc((board = (newBoard && createBoard(prop)) || board)[action], prop),
    //
    // Propagated by component Start
    clear = evt("clear", true),
    create = evt("create", true),
    // Propagated by component Game
    next = evt("next"),
    // Propagated by component Board
    flip = evt("flip"),
    startMeasure = () => void show.start(),
    endMeasure = () => (showDiff = show.stop())
</script>
